(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[289],{2481:function(e,t,a){Promise.resolve().then(a.bind(a,8014))},8014:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return l}});var s=a(7573),n=a(7653);function l(){let[e,t]=(0,n.useState)([]),[a,l]=(0,n.useState)(""),[o,i]=(0,n.useState)(""),[r,c]=(0,n.useState)("todo"),[d,u]=(0,n.useState)(1),[h]=(0,n.useState)(8),[p,m]=(0,n.useState)(0),[j,v]=(0,n.useState)(""),[x,g]=(0,n.useState)(""),[b,N]=(0,n.useState)(!1),[f,k]=(0,n.useState)(null),y=(0,n.useMemo)(()=>Math.max(Math.ceil(p/h),1),[p,h]),S=async()=>{N(!0),k(null);let e=new URLSearchParams({page:String(d),pageSize:String(h)});j&&e.set("status",j),x&&e.set("search",x);try{let s=await fetch("/api/tasks?".concat(e.toString()),{credentials:"include"});if(!s.ok){var a;let e=await s.json();throw Error((null==e?void 0:null===(a=e.error)||void 0===a?void 0:a.message)||"Failed to load tasks")}let n=await s.json();t(n.items),m(n.total)}catch(e){k(e instanceof Error?e.message:"Failed to load tasks")}finally{N(!1)}};(0,n.useEffect)(()=>{S()},[d,j]);let w=async e=>{e.preventDefault(),k(null);try{let e=await fetch("/api/tasks",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({title:a,description:o,status:r})});if(!e.ok){var t;let a=await e.json();throw Error((null==a?void 0:null===(t=a.error)||void 0===t?void 0:t.message)||"Failed to create task")}l(""),i(""),c("todo"),u(1),await S()}catch(e){k(e instanceof Error?e.message:"Failed to create task")}},C=async(e,t)=>{k(null);try{let s=await fetch("/api/tasks/".concat(e),{method:"PATCH",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({status:t})});if(!s.ok){var a;let e=await s.json();throw Error((null==e?void 0:null===(a=e.error)||void 0===a?void 0:a.message)||"Failed to update task")}await S()}catch(e){k(e instanceof Error?e.message:"Failed to update task")}},E=async e=>{k(null);try{let a=await fetch("/api/tasks/".concat(e),{method:"DELETE",credentials:"include"});if(!a.ok&&204!==a.status){var t;let e=await a.json();throw Error((null==e?void 0:null===(t=e.error)||void 0===t?void 0:t.message)||"Failed to delete task")}await S()}catch(e){k(e instanceof Error?e.message:"Failed to delete task")}};return(0,s.jsxs)("main",{className:"grid",children:[(0,s.jsxs)("section",{className:"panel",children:[(0,s.jsx)("h1",{children:"Your tasks"}),(0,s.jsxs)("form",{className:"form",onSubmit:w,children:[(0,s.jsx)("label",{className:"label",children:"Title"}),(0,s.jsx)("input",{className:"input",value:a,onChange:e=>l(e.target.value),required:!0}),(0,s.jsx)("label",{className:"label",children:"Description"}),(0,s.jsx)("textarea",{className:"input",value:o,onChange:e=>i(e.target.value),rows:3,required:!0}),(0,s.jsx)("label",{className:"label",children:"Status"}),(0,s.jsxs)("select",{className:"input",value:r,onChange:e=>c(e.target.value),children:[(0,s.jsx)("option",{value:"todo",children:"Todo"}),(0,s.jsx)("option",{value:"in_progress",children:"In progress"}),(0,s.jsx)("option",{value:"done",children:"Done"})]}),(0,s.jsx)("button",{className:"button",type:"submit",children:"Create task"})]})]}),(0,s.jsxs)("section",{className:"panel",children:[(0,s.jsxs)("div",{className:"toolbar",children:[(0,s.jsx)("input",{className:"input",placeholder:"Search title",value:x,onChange:e=>g(e.target.value)}),(0,s.jsx)("button",{className:"button secondary",type:"button",onClick:()=>S(),children:"Search"}),(0,s.jsxs)("select",{className:"input",value:j,onChange:e=>{v(e.target.value),u(1)},children:[(0,s.jsx)("option",{value:"",children:"All status"}),(0,s.jsx)("option",{value:"todo",children:"Todo"}),(0,s.jsx)("option",{value:"in_progress",children:"In progress"}),(0,s.jsx)("option",{value:"done",children:"Done"})]})]}),f&&(0,s.jsx)("p",{className:"notice",children:f}),b?(0,s.jsx)("p",{className:"notice",children:"Loading tasks..."}):(0,s.jsx)("div",{className:"grid",children:e.map(e=>(0,s.jsxs)("article",{className:"task",children:[(0,s.jsxs)("div",{className:"toolbar",style:{justifyContent:"space-between"},children:[(0,s.jsx)("span",{className:"task-title",children:e.title}),(0,s.jsx)("span",{className:"badge",children:e.status.replace("_"," ")})]}),(0,s.jsx)("p",{children:e.description}),(0,s.jsxs)("small",{className:"notice",children:["Created ",new Date(e.createdAt).toLocaleDateString()]}),(0,s.jsxs)("div",{className:"toolbar",children:[(0,s.jsxs)("select",{className:"input",value:e.status,onChange:t=>C(e.id,t.target.value),children:[(0,s.jsx)("option",{value:"todo",children:"Todo"}),(0,s.jsx)("option",{value:"in_progress",children:"In progress"}),(0,s.jsx)("option",{value:"done",children:"Done"})]}),(0,s.jsx)("button",{className:"button secondary",type:"button",onClick:()=>E(e.id),children:"Delete"})]})]},e.id))}),(0,s.jsxs)("div",{className:"toolbar",style:{justifyContent:"space-between"},children:[(0,s.jsx)("button",{className:"button secondary",type:"button",onClick:()=>u(e=>Math.max(e-1,1)),disabled:d<=1,children:"Prev"}),(0,s.jsxs)("span",{className:"notice",children:["Page ",d," of ",y]}),(0,s.jsx)("button",{className:"button secondary",type:"button",onClick:()=>u(e=>Math.min(e+1,y)),disabled:d>=y,children:"Next"})]})]})]})}}},function(e){e.O(0,[293,286,744],function(){return e(e.s=2481)}),_N_E=e.O()}]);