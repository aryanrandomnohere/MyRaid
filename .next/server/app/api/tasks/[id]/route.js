"use strict";(()=>{var e={};e.id=974,e.ids=[974],e.modules={2934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},2781:e=>{e.exports=require("stream")},3837:e=>{e.exports=require("util")},3912:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>T,patchFetch:()=>R,requestAsyncStorage:()=>y,routeModule:()=>k,serverHooks:()=>E,staticGenerationAsyncStorage:()=>_});var s={};r.r(s),r.d(s,{DELETE:()=>v,GET:()=>w,PATCH:()=>x});var i=r(3036),n=r(5736),a=r(5262),o=r(942),u=r(9763),d=r(7426),c=r(4685),p=r(304),l=r(5824),f=r(4291),g=r(2911);let h=u.Km(["todo","in_progress","done"]),m=u.Ry({title:u.Z_().min(1).max(120).optional(),description:u.Z_().max(2e3).optional(),status:h.optional()}).refine(e=>Object.keys(e).length>0,{message:"Provide at least one field to update"});async function w(e,{params:t}){try{let e=await (0,c.mk)(),r=await d.Z.task.findFirst({where:{id:t.id,userId:e.id}});if(!r)throw new p.g(404,"Task not found","not_found");return o.NextResponse.json({task:{id:r.id,title:r.title,description:(0,f._)(r.descriptionEnc,r.descriptionIv,r.descriptionTag),status:r.status,createdAt:r.createdAt}},{status:200})}catch(r){let{payload:e,status:t}=(0,g._)(r);return o.NextResponse.json(e,{status:t})}}async function x(e,{params:t}){try{let r=await (0,c.mk)(),s=await e.json(),i=(0,l.K)(m,s),n=await d.Z.task.findFirst({where:{id:t.id,userId:r.id}});if(!n)throw new p.g(404,"Task not found","not_found");let a={};if(void 0!==i.title&&(a.title=i.title),void 0!==i.status&&(a.status=i.status),void 0!==i.description){let e=(0,f.l)(i.description);a.descriptionEnc=e.cipherText,a.descriptionIv=e.iv,a.descriptionTag=e.tag}let u=await d.Z.task.update({where:{id:n.id},data:a});return o.NextResponse.json({task:{id:u.id,title:u.title,description:(0,f._)(u.descriptionEnc,u.descriptionIv,u.descriptionTag),status:u.status,createdAt:u.createdAt}},{status:200})}catch(r){let{payload:e,status:t}=(0,g._)(r);return o.NextResponse.json(e,{status:t})}}async function v(e,{params:t}){try{let e=await (0,c.mk)(),r=await d.Z.task.findFirst({where:{id:t.id,userId:e.id}});if(!r)throw new p.g(404,"Task not found","not_found");return await d.Z.task.delete({where:{id:r.id}}),new o.NextResponse(null,{status:204})}catch(r){let{payload:e,status:t}=(0,g._)(r);return o.NextResponse.json(e,{status:t})}}let k=new i.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/tasks/[id]/route",pathname:"/api/tasks/[id]",filename:"route",bundlePath:"app/api/tasks/[id]/route"},resolvedPagePath:"/Users/aryanrathore/Desktop/Myraid/apps/web/src/app/api/tasks/[id]/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:y,staticGenerationAsyncStorage:_,serverHooks:E}=k,T="/api/tasks/[id]/route";function R(){return(0,a.patchFetch)({serverHooks:E,staticGenerationAsyncStorage:_})}},2911:(e,t,r)=>{r.d(t,{_:()=>i});var s=r(304);function i(e){if(e instanceof s.g){let t={error:{code:e.code,message:e.message}};return e.details&&(t.error.details=e.details),{payload:t,status:e.status}}return{payload:{error:{code:"internal_error",message:"Internal server error"}},status:500}}},4685:(e,t,r)=>{r.d(t,{$Q:()=>p,fT:()=>u,mk:()=>c});var s=r(9362),i=r(5388),n=r.n(i),a=r(304);let o=()=>{if(!process.env.JWT_SECRET)throw new a.g(500,"JWT secret not configured","config_error");return process.env.JWT_SECRET},u=e=>{let t=o(),r=process.env.JWT_EXPIRES_IN||"1h";return n().sign(e,t,{expiresIn:r})},d=async()=>{try{let e=await (0,s.cookies)(),t=e.get("access_token")?.value;if(!t)return null;return n().verify(t,o())}catch{return null}},c=async()=>{let e=await d();if(!e)throw new a.g(401,"Unauthorized","unauthorized");return e},p=()=>({httpOnly:!0,secure:"true"===(process.env.COOKIE_SECURE||"true"),sameSite:"lax",maxAge:36e5})},7426:(e,t,r)=>{r.d(t,{Z:()=>i});let s=require("@prisma/client"),i=global.prisma||new s.PrismaClient},4291:(e,t,r)=>{r.d(t,{_:()=>u,l:()=>o});var s=r(6113),i=r.n(s),n=r(304);let a=()=>{let e=process.env.ENCRYPTION_KEY;if(!e)throw new n.g(500,"Encryption key not configured","config_error");if(64!==e.length)throw new n.g(500,"Encryption key must be 64 hex characters","config_error");return Buffer.from(e,"hex")},o=e=>{let t=a(),r=i().randomBytes(12),s=i().createCipheriv("aes-256-gcm",t,r),n=Buffer.concat([s.update(e,"utf8"),s.final()]),o=s.getAuthTag();return{cipherText:n.toString("base64"),iv:r.toString("base64"),tag:o.toString("base64")}},u=(e,t,r)=>{let s=a(),n=i().createDecipheriv("aes-256-gcm",s,Buffer.from(t,"base64"));return n.setAuthTag(Buffer.from(r,"base64")),Buffer.concat([n.update(Buffer.from(e,"base64")),n.final()]).toString("utf8")}},304:(e,t,r)=>{r.d(t,{g:()=>s});class s extends Error{constructor(e,t,r="error",s){super(t),this.status=e,this.code=r,this.details=s}}},5824:(e,t,r)=>{r.d(t,{K:()=>i});var s=r(304);let i=(e,t)=>{let r=e.safeParse(t);if(!r.success)throw new s.g(400,"Validation error","validation_error",r.error.flatten());return r.data}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[522,746,692,763],()=>r(3912));module.exports=s})();