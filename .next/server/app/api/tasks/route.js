"use strict";(()=>{var e={};e.id=495,e.ids=[495],e.modules={2934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},2781:e=>{e.exports=require("stream")},3837:e=>{e.exports=require("util")},2235:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>_,patchFetch:()=>E,requestAsyncStorage:()=>y,routeModule:()=>v,serverHooks:()=>w,staticGenerationAsyncStorage:()=>k});var s={};r.r(s),r.d(s,{GET:()=>x,POST:()=>h});var a=r(3036),n=r(5736),i=r(5262),o=r(942),u=r(9763),c=r(7426),d=r(4685),p=r(5824),l=r(4291),g=r(2911);let f=u.Km(["todo","in_progress","done"]),m=u.Ry({title:u.Z_().min(1).max(120),description:u.Z_().min(1).max(2e3),status:f.optional()});async function h(e){try{let t=await (0,d.mk)(),r=await e.json(),{title:s,description:a,status:n}=(0,p.K)(m,r),i=(0,l.l)(a),u=await c.Z.task.create({data:{title:s,descriptionEnc:i.cipherText,descriptionIv:i.iv,descriptionTag:i.tag,status:n||"todo",userId:t.id}});return o.NextResponse.json({task:{id:u.id,title:u.title,description:a,status:u.status,createdAt:u.createdAt}},{status:201})}catch(r){let{payload:e,status:t}=(0,g._)(r);return o.NextResponse.json(e,{status:t})}}async function x(e){try{let t=await (0,d.mk)(),r=e.nextUrl.searchParams,s=Math.max(Number(r.get("page")||1),1),a=Math.min(Math.max(Number(r.get("pageSize")||10),1),50),n=r.get("status")?f.parse(r.get("status")):void 0,i=r.get("search")||void 0,u={userId:t.id,...n?{status:n}:{},...i?{title:{contains:i,mode:"insensitive"}}:{}},[p,g]=await Promise.all([c.Z.task.count({where:u}),c.Z.task.findMany({where:u,orderBy:{createdAt:"desc"},skip:(s-1)*a,take:a})]),m=g.map(e=>({id:e.id,title:e.title,description:(0,l._)(e.descriptionEnc,e.descriptionIv,e.descriptionTag),status:e.status,createdAt:e.createdAt}));return o.NextResponse.json({page:s,pageSize:a,total:p,items:m},{status:200})}catch(r){let{payload:e,status:t}=(0,g._)(r);return o.NextResponse.json(e,{status:t})}}let v=new a.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/tasks/route",pathname:"/api/tasks",filename:"route",bundlePath:"app/api/tasks/route"},resolvedPagePath:"/Users/aryanrathore/Desktop/Myraid/apps/web/src/app/api/tasks/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:y,staticGenerationAsyncStorage:k,serverHooks:w}=v,_="/api/tasks/route";function E(){return(0,i.patchFetch)({serverHooks:w,staticGenerationAsyncStorage:k})}},2911:(e,t,r)=>{r.d(t,{_:()=>a});var s=r(304);function a(e){if(e instanceof s.g){let t={error:{code:e.code,message:e.message}};return e.details&&(t.error.details=e.details),{payload:t,status:e.status}}return{payload:{error:{code:"internal_error",message:"Internal server error"}},status:500}}},4685:(e,t,r)=>{r.d(t,{$Q:()=>p,fT:()=>u,mk:()=>d});var s=r(9362),a=r(5388),n=r.n(a),i=r(304);let o=()=>{if(!process.env.JWT_SECRET)throw new i.g(500,"JWT secret not configured","config_error");return process.env.JWT_SECRET},u=e=>{let t=o(),r=process.env.JWT_EXPIRES_IN||"1h";return n().sign(e,t,{expiresIn:r})},c=async()=>{try{let e=await (0,s.cookies)(),t=e.get("access_token")?.value;if(!t)return null;return n().verify(t,o())}catch{return null}},d=async()=>{let e=await c();if(!e)throw new i.g(401,"Unauthorized","unauthorized");return e},p=()=>({httpOnly:!0,secure:"true"===(process.env.COOKIE_SECURE||"true"),sameSite:"lax",maxAge:36e5})},7426:(e,t,r)=>{r.d(t,{Z:()=>a});let s=require("@prisma/client"),a=global.prisma||new s.PrismaClient},4291:(e,t,r)=>{r.d(t,{_:()=>u,l:()=>o});var s=r(6113),a=r.n(s),n=r(304);let i=()=>{let e=process.env.ENCRYPTION_KEY;if(!e)throw new n.g(500,"Encryption key not configured","config_error");if(64!==e.length)throw new n.g(500,"Encryption key must be 64 hex characters","config_error");return Buffer.from(e,"hex")},o=e=>{let t=i(),r=a().randomBytes(12),s=a().createCipheriv("aes-256-gcm",t,r),n=Buffer.concat([s.update(e,"utf8"),s.final()]),o=s.getAuthTag();return{cipherText:n.toString("base64"),iv:r.toString("base64"),tag:o.toString("base64")}},u=(e,t,r)=>{let s=i(),n=a().createDecipheriv("aes-256-gcm",s,Buffer.from(t,"base64"));return n.setAuthTag(Buffer.from(r,"base64")),Buffer.concat([n.update(Buffer.from(e,"base64")),n.final()]).toString("utf8")}},304:(e,t,r)=>{r.d(t,{g:()=>s});class s extends Error{constructor(e,t,r="error",s){super(t),this.status=e,this.code=r,this.details=s}}},5824:(e,t,r)=>{r.d(t,{K:()=>a});var s=r(304);let a=(e,t)=>{let r=e.safeParse(t);if(!r.success)throw new s.g(400,"Validation error","validation_error",r.error.flatten());return r.data}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[522,746,692,763],()=>r(2235));module.exports=s})();